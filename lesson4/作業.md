## 問題13. 查各國總死亡數佔確診數比例
<!--"ID"iso_code洲名國家日期總確診數新增確診數七天移動平均新增確診數總死亡數新增死亡數七天移動平均新增死亡數每百萬人確診數每百萬人死亡數傳染率新增檢驗件數總檢驗件數每千人檢驗件數七天移動平均新增檢驗件數陽性率每確診案例相對檢驗數量疫苗總接種總劑數疫苗總接種人數疫苗新增接種劑數七天移動平均疫苗新增接種劑數每百人接種疫苗劑數每百人接種疫苗人數疫情控管指數總人口數中位數年紀"70歲以上人口比例"平均壽命解除隔離數解封指數
以上是資料庫的欄位名稱, 我想查各國總死亡數佔確診數比例, 請給我postgres的語法-->
<!--資料的內容有每日的日期, 所以必須做加總, 請修正!-->

```sql
SELECT
  國家,
  SUM(總死亡數) AS 總死亡數,
  SUM(總確診數) AS 總確診數,
  CASE
    WHEN SUM(總確診數) = 0 THEN NULL
    ELSE ROUND((SUM(總死亡數)::numeric / SUM(總確診數)) * 100, 2)
  END AS 死亡佔確診比例_百分比
FROM world
GROUP BY 國家
HAVING SUM(總確診數) > 0
ORDER BY 死亡佔確診比例_百分比 DESC;
```

### **🚩 RESULT**

|國家|總死亡數|總確診數|死亡佔確診比例_百分比|
|--|----|----|-----------|
|北韓|324|54|600.00|
|葉門|984906|4945235|19.92|
|祕魯|117368375|1461450297|8.03|
|墨西哥|159832658|2197839271|7.27|
|蘇丹|1956017|27328529|7.16|
|敘利亞|1285041|21147637|6.08|
|埃及|11149907|207750651|5.37|
|厄瓜多|17609651|335568343|5.25|
|索馬利亞|562912|11174158|5.04|
|阿富汗|3497795|80633318|4.34|
|賴比瑞亞|132218|3077565|4.30|
|波士尼亞赫塞哥維納|6378348|149856800|4.26|
|保加利亞|13579400|372282260|3.65|
|尼日|146138|4006858|3.65|
|查德|114948|3338610|3.44|
|玻利維亞|10925251|331077648|3.30|
|馬拉威|1072778|33008295|3.25|
|緬甸|7150463|220523422|3.24|
|馬其頓|3815964|118489841|3.22|
|突尼西亞|11409251|363544489|3.14|
|甘比亞|168038|5361334|3.13|
|馬利|344938|11301763|3.05|
|巴拉圭|7504356|251190906|2.99|
|匈牙利|18414572|622965266|2.96|
|印尼|61212390|2088595215|2.93|
|薩爾瓦多|1858689|64728450|2.87|
|南非|45860419|1621275400|2.83|
|阿爾及利亞|3208864|116232206|2.76|
|葛摩聯盟|81311|2988131|2.72|
|辛巴威|2079571|76720762|2.71|
|千里達|1041712|38721807|2.69|
|羅馬尼亞|25445823|961896560|2.65|
|宏都拉斯|5024310|190081051|2.64|
|中國大陸|3998774|153100068|2.61|
|海地|359066|13813333|2.60|
|巴西|318791717|12512257406|2.55|
|瓜地馬拉|7529228|297631860|2.53|
|坦尚尼亞|229802|9261991|2.48|
|哥倫比亞|65810569|2662220487|2.47|
|賴索托|280336|11515327|2.43|
|塞內加爾|905734|37915632|2.39|
|巴哈馬|292173|12338849|2.37|
|史瓦帝尼王國|590241|24853998|2.37|
|伊朗|65186482|2762047452|2.36|
|納米比亞|1475009|62987582|2.34|
|摩爾多瓦|4630045|199383225|2.32|
|俄羅斯|127072842|5516005463|2.30|
|烏克蘭|41382363|1806736178|2.29|
|斯里蘭卡|5142876|229448101|2.24|
|波蘭|46800971|2097539980|2.23|
|牙買加|1012805|45396469|2.23|
|尼加拉瓜|140654|6373487|2.21|
|安哥拉|759194|34501046|2.20|
|柬埔寨|992902|45479150|2.18|
|蓋亞那|432382|19823259|2.18|
|巴基斯坦|14761588|693421336|2.13|
|安地卡|44514|2090545|2.13|
|烏干達|1297687|61848544|2.10|
|獅子山|75321|3754730|2.01|
|馬達加斯加|556535|27642433|2.01|
|亞美尼亞|3567729|177068732|2.01|
|茅利塔尼亞伊斯蘭共和國|429722|21782468|1.97|
|幾內亞比索|71180|3630812|1.96|
|義大利|83684910|4315743058|1.94|
|智利|22972892|1182761975|1.94|
|蘇利南|466001|24247076|1.92|
|剛果民主共和國|636637|33734416|1.89|
|肯亞|2529688|137635673|1.84|
|阿根廷|59070090|3221518405|1.83|
|格瑞那達|60512|3361338|1.80|
|全球|2773111831|161711661903|1.71|
|克羅埃西亞|5842686|343307543|1.70|
|菲律賓|21683156|1305164748|1.66|
|喀麥隆|879186|53182916|1.65|
|布吉那法索|150406|9241104|1.63|
|聖露西亞|110480|6787366|1.63|
|加拿大|19009438|1189072523|1.60|
|孟加拉|12868847|810863540|1.59|
|衣索比亞|3173134|199416433|1.59|
|貝里斯|271597|17203820|1.58|
|吉爾吉斯|1511189|95422273|1.58|
|剛果|156536|9995339|1.57|
|比利時|17605015|1153213933|1.53|
|阿爾巴尼亞|1603932|104795911|1.53|
|摩洛哥|7484026|491430053|1.52|
|美國|450546270|29779934309|1.51|
|西班牙|56277013|3749019747|1.50|
|哈薩克|7467702|501361169|1.49|
|渥里斯及伏塔那|3199|216165|1.48|
|英國|89612576|6172597580|1.45|
|沙烏地阿拉伯|5374998|374428888|1.44|
|尚比亞|1641730|113622912|1.44|
|利比亞|2587442|184246800|1.40|
|聖多美普林西比|30863|2221748|1.39|
|捷克|18044896|1300714296|1.39|
|巴布亞紐幾內亞|191408|13746056|1.39|
|巴拿馬|4335399|313635867|1.38|
|希臘|9667226|712898085|1.36|
|蒙瑟拉特|1207|91056|1.33|
|聖馬利諾|64288|4854743|1.32|
|蒙特內哥羅|1124055|84883430|1.32|
|奈及利亞|1626524|123128109|1.32|
|亞塞拜然|3811059|292030308|1.31|
|赤道幾內亞|94844|7253390|1.31|
|印度|234731097|18180768089|1.29|
|伊拉克|12906330|1004725014|1.28|
|斐濟|250473|19997087|1.25|
|尼泊爾|5067716|408079859|1.24|
|吉布地|97432|7970195|1.22|
|百慕達|42287|3483930|1.21|
|盧安達|535153|45069671|1.19|
|瑞典|9871973|826748721|1.19|
|喬治亞|5472873|462545789|1.18|
|阿曼|2046967|175532604|1.17|
|黎巴嫩|4537380|397906847|1.14|
|德國|57947763|5130075717|1.13|
|哥斯大黎加|3417976|301628400|1.13|
|委內瑞拉|2299573|207024462|1.11|
|立陶宛|3310079|299428843|1.11|
|烏拉圭|2789186|253576755|1.10|
|聖文森|27940|2533035|1.10|
|斯洛伐克|7695177|707746308|1.09|
|波札那|985416|90722452|1.09|
|莫三比克|863385|80124570|1.08|
|拉脫維亞|1948166|181634115|1.07|
|斯洛維尼亞|2891744|271152518|1.07|
|法國|73964739|6960054547|1.06|
|英屬維爾京群島|17487|1655025|1.06|
|約旦|5983443|563346871|1.06|
|直布羅陀|52071|4964921|1.05|
|多明尼加|2526235|240822910|1.05|
|南蘇丹|77206|7517795|1.03|
|葡萄牙|10741199|1055743070|1.02|
|馬爾他|278605|27651806|1.01|
|法屬玻里尼西亞|237888|23619888|1.01|
|幾內亞|177332|17753703|1.00|
|巴勒斯坦|2352169|240629151|0.98|
|中非|64860|6623644|0.98|
|奧地利|8553439|892262594|0.96|
|列支敦斯登|37343|3981391|0.94|
|索羅門群島|19600|2129873|0.92|
|馬來西亞|10733528|1169560179|0.92|
|愛爾蘭|3489058|389464907|0.90|
|塞爾維亞|5693913|649329368|0.88|
|多哥|116039|13145585|0.88|
|象牙海岸|315400|36582169|0.86|
|迦納|635299|75976111|0.84|
|維德角|181036|22115955|0.82|
|古巴|2843986|352899397|0.81|
|瑞士|7074112|876298270|0.81|
|泰國|7575749|946162238|0.80|
|土耳其|37988906|4725747846|0.80|
|貝南|78815|10079508|0.78|
|厄利垂亞|28818|3738862|0.77|
|新克里多亞|81141|10522092|0.77|
|盧森堡|518946|67865881|0.76|
|阿魯巴|86650|11393510|0.76|
|香港|1145833|152607853|0.75|
|白俄羅斯|2603059|349117995|0.75|
|聖克里斯多福|10217|1373589|0.74|
|古拉索|89639|12110255|0.74|
|塔吉克|78341|10893905|0.72|
|摩納哥|21562|3003620|0.72|
|烏茲別克|709923|99544289|0.71|
|越南|10595043|1508918395|0.70|
|土克斯及開科斯群島|14011|2074779|0.68|
|巴貝多|98550|14581796|0.68|
|安道爾|88282|13049101|0.68|
|加彭|126832|19563722|0.65|
|日本|10070359|1548736768|0.65|
|愛沙尼亞|888480|142320792|0.62|
|荷蘭|12234147|1970673306|0.62|
|模里西斯|217486|38409628|0.57|
|芬蘭|1079096|197872985|0.55|
|東帝汶|40961|7694147|0.53|
|曼島|36601|6912980|0.53|
|多米尼克|14704|2824681|0.52|
|波奈、聖佑達修斯及沙巴|11165|2129790|0.52|
|科威特|1293067|250913374|0.52|
|以色列|4653970|1068064940|0.44|
|塞席爾|53495|12377851|0.43|
|吉里巴斯|1807|463546|0.39|
|巴林|691001|188670484|0.37|
|寮國|137086|39180271|0.35|
|丹麥|2086078|623199287|0.33|
|台灣|490240|149921382|0.33|
|賽普勒斯|325336|105386153|0.31|
|安圭拉|1849|642735|0.29|
|阿拉伯聯合大公國|1150068|400264187|0.29|
|挪威|803911|286003794|0.28|
|蒙古|673056|245113340|0.27|
|馬爾地夫|120509|53970192|0.22|
|汶萊|42922|20621687|0.21|
|卡達|345021|169155352|0.20|
|澳大利亞|1740612|934560286|0.19|
|薩摩亞|2008|1055613|0.19|
|韓國|3930885|2099747144|0.19|
|萬那杜|1495|848883|0.18|
|格陵蘭|3033|2221268|0.14|
|新加坡|286326|226299442|0.13|


## 問題14. 查詢哪個國家總確診數最少
<!--相同的資料庫欄位名稱, 我想查詢哪個國家總確診數最少, 請給我postgres的語法-->

```sql
SELECT
  國家,
  SUM(總確診數) AS 總確診數
FROM world
GROUP BY 國家
HAVING SUM(總確診數) > 0
ORDER BY 總確診數 ASC
LIMIT 1;
```

### **🚩 RESULT**

|國家|總確診數|
|--|----|
|北韓|54|


## 問題15. 台灣每個月的死亡率
<!--相同的資料庫欄位名稱, 我想查詢台灣每個月的死亡率, 請給我postgres的語法-->

```sql
SELECT
  TO_CHAR(日期, 'YYYY-MM') AS 年月,
  SUM(新增死亡數) AS 月死亡總數,
  SUM(新增確診數) AS 月確診總數,
  CASE
    WHEN SUM(新增確診數) = 0 THEN NULL
    ELSE ROUND((SUM(新增死亡數)::numeric / SUM(新增確診數)) * 100, 2)
  END AS 月死亡率_百分比
FROM world
WHERE 國家 = '台灣'
GROUP BY 年月
ORDER BY 年月;
```

### **🚩 RESULT**

|年月|月死亡總數|月確診總數|月死亡率_百分比|
|--|-----|-----|--------|
|2020-01|0|9|0.00|
|2020-02|1|29|3.45|
|2020-03|4|283|1.41|
|2020-04|1|107|0.93|
|2020-05|1|13|7.69|
|2020-06|0|5|0.00|
|2020-07|0|20|0.00|
|2020-08|0|24|0.00|
|2020-09|0|26|0.00|
|2020-10|0|41|0.00|
|2020-11|0|120|0.00|
|2020-12|0|124|0.00|
|2021-01|1|112|0.89|
|2021-02|1|44|2.27|
|2021-03|1|75|1.33|
|2021-04|2|98|2.04|
|2021-05|112|7383|1.52|
|2021-06|524|6293|8.33|
|2021-07|139|870|15.98|
|2021-08|48|321|14.95|
|2021-09|7|228|3.07|
|2021-10|5|189|2.65|
|2021-11|1|189|0.53|
|2021-12|2|428|0.47|
|2022-01|1|1761|0.06|
|2022-02|2|1699|0.12|
|2022-03|0|2905|0.00|
|2022-04|12|92489|0.01|
|2022-05|1390|1917100|0.07|
|2022-06|4396|1734300|0.25|
|2022-07|572|196905|0.29|


## 問題16. 查那個國家的死亡人數最低的前10名的國家
<!--相同的資料庫欄位名稱, 我想查詢死亡人數最低的前10名國家, 請給我postgres的語法-->

```sql
SELECT
  國家,
  SUM(新增死亡數) AS 總死亡數
FROM world
GROUP BY 國家
HAVING SUM(新增死亡數) > 0
ORDER BY 總死亡數 ASC
LIMIT 10;
```

### **🚩 RESULT**

|國家|總死亡數|
|--|----|
|庫克群島|1|
|聖匹及密啟倫群島|1|
|澳門|2|
|帛琉|6|
|北韓|6|
|渥里斯及伏塔那|7|
|蒙瑟拉特|9|
|安圭拉|10|
|東加|12|
|吉里巴斯|13|


## 問題17. 哪一日死亡人數最多?

### 方法一：直接用全球加總數
<!--相同的資料庫欄位名稱, 我想查哪一日死亡人數最多, 請給我postgres的語法-->

```sql
SELECT 洲名, 日期, 新增死亡數
FROM world
ORDER BY 新增死亡數 DESC
LIMIT 1;
```

### **🚩 RESULT**

| 洲名 | 日期       | 新增死亡數 |
|------|------------|------------|
| 全球 | 2021-01-20 | 18,156      |


### 方法二：排除全球加總數
<!--我想用加總的方式, 並排除某一洲名-->

```sql
SELECT 日期, SUM(新增死亡數) AS 每日新增死亡總數
FROM world
WHERE 洲名 <> '全球'  -- 排除加總數
GROUP BY 日期
ORDER BY 每日新增死亡總數 DESC
LIMIT 1;
```

### **🚩 RESULT**

| 日期       | 每日新增死亡總數 |
|------------|------------------|
| 2021-01-20 | 18,147            |

